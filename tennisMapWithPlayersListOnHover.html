<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="d3.slider.css" />  
</head>
<style>


body {
  font: 12px sans-serif;
  background-color:  #f1f1f1;
  margin-left: auto;
  margin-right: auto;
  padding: 0px;
  width: 90%;
  /*width: 1500px;*/
}
button{
  position: absolute;
  z-index: 999;
  top: 850px;
  left: 85px;
  width: 13em;
  padding: 0.6em 0.6em 0.5em 0.5em;
  text-align: center;

}
#credit{
  position: absolute;
  margin-top: 64%;
  margin-left: 61.5%;
  color: #555;
  font-size: 10px;

}
text.count{
  fill: #ccc;
}
.histogramNationName{
  fill: #5E545D;
  font-size: 13px;
}
.histogramNationName tspan{
  font-weight: bold;
 
}
.container{
  margin-left: auto;
  margin-right: auto;
  
}

.rankingList:not(.selectedPlayers){
  opacity: 1;
}

.countryRect{
  /*fill: #404040;*/
  fill: #737373;
}

.countryRect:hover{
  fill: steelblue;
  /*opacity: 0.8;*/
}

.divContainer{
  /*display:none;*/
  /*top: 200px;*/
  width: 18em;
  padding-top: 5px;
  padding-bottom: 5px;
  /*padding-left: 10px;*/
  /*padding-right: 10px;*/
  background-color: #111;
  opacity:0.9;
  position: absolute;
  color: #f0f0f0;
  font-size: 13px;
  /*top:50px;
  left:50px;*/
}

table{
  width: 100%;
  /*border-color: red;*/
  border-collapse: collapse;
}
td{
  padding:0.3em;
  
}
tr{
  border-width: 2px;
  border-color: red;
  
}
th{
  text-transform: uppercase;
}
th.name{
  text-align: left;

  /*background-color: #fff*/
}
th.ranking{
  text-align: right;
}
.rankingCell{
 text-align: right; 
}
.nameCell{
  text-align: left;
}
tr:nth-child(even) {
    background-color: #505050;
}
/*.divcontainer{
  display:block;
}*/
svg{
  position: absolute;
  margin-left: auto;
  margin-right: auto;
}
.svgInDivContainer{
  background-color: #111;
  opacity: 0.9;
  position: absolute;
  /*top: 50px;
  left: 100px;*/
  /*display:none;*/
}
.divContainer{
  display:none;
}
.divContainer:after{
  content:"\25B2";   
  box-sizing: border-box;
  display: inline;
  font-size: 20px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  /*content: "\25C0";*/
  position: absolute;
  /*text-align: center;*/
  top:-25px;
  margin: 10px 0px 0px 0px;
  left:45%;
  border-radius: 2px;
}
#try{
position: absolute;
height: 200px;
left: 50px;
top: 100px;
}
.selectedPlayers{
  opacity: 0.5;
}

#slider{
position: absolute;
z-index: 3;
/*background-color: black;*/
/*height: 100px;*/
width: 1000px;
}

text.year{
  font-weight: 200;
}
text.year.selected{
  /*fill: orange;*/
  font-weight: bolder;
}

.Antarctica{
  /*display: none;*/
}
h1{
  /*position: absolute;*/
  display: block;
  background-color: white;
  margin-top: 20px;
  float: right;
  /*top: 100px;
  width: 200px;*/
  /*left: 10%;*/
}
.tick line{
  /*stroke: black;*/
  /*display: none;*/
}


text.year:hover{
  font-weight: bold;
  cursor: pointer;
  /*fill: steelblue;*/
  opacity:0.7;
  
}
#tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 15px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25C0";
  position: absolute;
  /*text-align: center;*/
  top:20%;
  margin: 0px 0px 0px -10px;
  left:0%;
  border-radius: 2px;
}

#tip{

  background-color: rgba(0, 0, 0, 0.9);
  color: #fff;
  padding-top: 1px;
  /*padding-bottom: 2px;*/
  padding: 2px 15px 2px 15px;
  /*padding: 5px;*/
  line-height: 1.2;
  /*border-radius: 2px;*/

}


#tip p{
  padding: 4px 3px 4px 3px;
  margin: 12px 0px 12px 0px;
  color: #ddd;
  font-size: 14px;
  font-weight: light;
  letter-spacing: 0.01em;

}

span#countryName{
  color: #ff984d;
  font-size: 24px;
  text-transform: uppercase;
  /*margin-bottom: 40px;*/
}

p #year, p #playerCount{
  color: #ff984d;

font-weight: bold;
}



.svgForMap{
  background: #eee;
  position: absolute;
  top:190px;

}
.histogramContainer{
  position: absolute;
  margin-left: auto;
  margin-right: auto;
  width: 90%;
}
.svgHistogram{
  position: absolute;
  margin-left: auto;
  margin-right: auto;
}

path {
  stroke: #222;
  stroke-width: 0.25px;
}


path:hover{
  fill: #969696;
  opacity: 0.8;
  /*stroke: #969696;*/
  /*stroke-width: 1px;*/
}

.xAxis line{
  stroke: black;
  stroke-width: 1px;
  shape-rendering: crispEdges;
}

.xAxis line:last-child{
  display:none;
  stroke: red;
  stroke-width: 2px;
}
.xAxis path{
  fill: none;
  stroke: black;
  stroke-width: 1px;

   /*stroke: #000;*/

}


h1 {
  position: absolute;
  top: 500px;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 18px;
  text-align: center;
  width: 960px;
}
</style>
<body>


<!-- <h1>
Distribution of Top 100 Tennis Players
</h1>
 -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="d3.slider.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
<script src = "http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script>
var width = 1200,
    height = 700;

var HeightForSvgHistogram = 170; 

var projection = d3.geo.kavrayskiy7()
    .scale(230)
    .translate([width / 2, height / 2])
    .precision(.1);

// var projection = d3.geo.mercator()
//     .center([-80, 50 ])
//     .scale(190)
//     .rotate([-180,0]);


var container = d3.select('body').append('div').attr('class','container')

var histogramContainer = d3.select('.container').append('div').attr('class','histogramContainer')

var svgHistogram = d3.select('body').select('.histogramContainer').append('svg')
                        .attr({
                          "width": width,
                          'height': HeightForSvgHistogram
                        })
                        .attr('class','svgHistogram')


var svg = d3.select("body").select('.container').append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr('class','svgForMap')
    
    // .attr("transform","translate(0," + HeightForSvgHistogram + 100  +")")

var xYear = d3.scale.linear().domain([1982,2016])
                    .range([20,width-20])

var path = d3.geo.path()
    .projection(projection);

var g = svg.append("g");


var yearArray = d3.range(1982,2017)
var xScale = d3.scale.linear().nice().domain([1982,2017]).rangeRound([0,width-100])

    // .attr("transform", "translate(" + margin.left + "," + height / 2 + ")");


    // .call(d3.drag()
    //     .on("start.interrupt", function() { slider.interrupt(); })
    //     .on("start drag", function() { hue(x.invert(d3.event.x)); }));





queue()
    .defer(d3.json, "world-110m2.json")
    .defer(d3.json, "tennis-data1.json")
    .await(ready);



// // load and display the World
function ready(error, topology, tennis) {
  loc = width/2
var mainTitleGroup = d3.select('.svgForMap').append('g').attr('class','mainTitleGroup').attr("transform", "translate(" + width/1.4   + "," + (height - 55) + ")")



mainTitleGroup.append('text').text("DISTRIBUTION OF TOP 100 TENNIS PLAYERS").attr('font-size','28px')
.attr('text-anchor','middle').attr('fill','#5E545D').attr('font-weight','100')

// var mainTitleBackground = mainTitleGroup.append('rect').attr('class','mainTitleBackground').attr('height','48px').attr('width','300px').attr('fill','#666').style('opacity','0.8').attr('x',0).attr('y',0)


// .attr("transform", "translate(" + width/1.3 + "," + height/1.1 + ")")

// .attr('x',width/2).attr('y',25).fill("black")



  var countries = topojson.feature(topology, topology.objects.countries).features;


var countryCodeMap = {"Canada": 124, "Moldova": 498, "Sao Tome and Principe": 678, "Guinea-Bissau": 624, "United States": 840, "Lithuania": 440, "Cambodia": 116, "Saint Helena, Ascension and Tristan da Cunha": 654, "Switzerland": 756, "Ethiopia": 231, "Aruba": 533, "Saint Martin (French part)": 663, "Solomon Islands": 90, "Argentina": 32, "Cameroon": 120, "Burkina Faso": 854, "Turkmenistan": 795, "Ghana": 288, "Saudi Arabia": 682, "Rwanda": 646, "Togo": 768, "Japan": 392, "American Samoa": 16, "United States Minor Outlying Islands": 581, "Cocos (Keeling) Islands": 166, "Pitcairn": 612, "Guatemala": 320, "Bosnia and Herzegovina": 70, "Kuwait": 414, "Russia": 643, "Jordan": 400, "Bonaire, Sint Eustatius and Saba": 535, "Dominica": 212, "Liberia": 430, "Maldives": 462, "Jamaica": 388, "Oman": 512, "Martinique": 474, "Cabo Verde": 132, "Christmas Island": 162, "French Guiana": 254, "Niue": 570, "Monaco": 492, "Wallis and Futuna": 876, "New Zealand": 554, "Yemen": 887, "Jersey": 832, "Andorra": 20, "Albania": 8, "Samoa": 882, "Norfolk Island": 574, "United Arab Emirates": 784, "Cote d'Ivoire": 384, "India": 356, "Azerbaijan": 31, "Lesotho": 426, "Saint Vincent and the Grenadines": 670, "Kenya": 404, "Macao": 446, "Guam": 316, "Turkey": 792, "Afghanistan": 4, "Virgin Islands (British)": 92, "Bangladesh": 50, "Mauritania": 478, "Congo": 180, "Turks and Caicos Islands": 796, "Saint Lucia": 662, "San Marino": 674, "French Polynesia": 258, "France": 250, "Svalbard and Jan Mayen": 744, "Syrian Arab Republic": 760, "Bermuda": 60, "Slovakia": 703, "Somalia": 706, "Peru": 604, "Swaziland": 748, "Nauru": 520, "Seychelles": 690, "Norway": 578, "Malawi": 454, "Cook Islands": 184, "Benin": 204, "Reunion": 638, "Western Sahara": 732, "Cuba": 192, "Montenegro": 499, "Falkland Islands (Malvinas)": 238, "Mayotte": 175, "Heard Island and McDonald Islands": 334, "China": 156, "Armenia": 51, "Timor Leste": 626, "Dominican Republic": 214, "Bolivia": 68, "Ukraine": 804, "Bahrain": 48, "Tonga": 776, "Finland": 246, "Libya": 434, "Macedonia": 807, "Cayman Islands" : 136, "Central African Republic": 140, "New Caledonia": 540, "Mauritius": 480, "Tajikistan": 762, "Liechtenstein": 438, "Australia": 36, "Mali": 466, "Sweden": 752, "Bulgaria": 100, "Palestine, State of": 275, "North Korea": 408, "Romania": 642, "Angola": 24, "French Southern Territories": 260, "Chad": 148, "South Africa": 710, "Tokelau": 772, "Cyprus": 196, "South Georgia and the South Sandwich Islands": 239, "Brunei Darussalam": 96, "Qatar": 634, "Malaysia": 458, "Austria": 40, "Mozambique": 508, "Uganda": 800, "Asland Islands": 248, "Hungary": 348, "Niger": 562, "Isle of Man": 833, "Brazil": 76, "Virgin Islands (U.S.)": 850, "Faroe Islands": 234, "Guinea": 324, "Panama": 591, "Costa Rica": 188, "Luxembourg": 442, "Bahamas": 44, "Gibraltar": 292, "Ireland": 372, "Pakistan": 586, "Palau": 585, "Nigeria": 566, "Ecuador": 218, "Czech Republic": 203, "Viet Nam": 704, "Belarus": 112, "Vanuatu": 548, "Algeria": 12, "Slovenia": 705, "El Salvador": 222, "Tuvalu": 798, "Saint Pierre and Miquelon": 666, "Iran": 364, "Marshall Islands": 584, "Chile": 152, "Puerto Rico": 630, "Belgium": 56, "Kiribati": 296, "Haiti": 332, "Belize": 84, "Hong Kong": 344, "South Korea": 410, "Georgia": 268, "Lao People's Democratic Republic": 418, "Gambia": 270, "Philippines": 608, "Morocco": 504, "Croatia": 191, "Mongolia": 496, "Guernsey": 831, "Thailand": 764, "Namibia": 516, "Grenada": 308, "Taiwan, Province of China": 158, "Venezuela": 862, "Iraq": 368, "Tanzania": 834, "Portugal": 620, "Estonia": 233, "Uruguay": 858, "Curacao": 531, "Saint Barthelemy": 652, "Equatorial Guinea": 226, "Lebanon": 422, "Sierra Leone": 694, "Uzbekistan": 860, "Tunisia": 788, "Djibouti": 262, "Greenland": 304, "Antigua and Barbuda": 28, "Spain": 724, "Colombia": 170, "Burundi": 108, "Fiji": 242, "Barbados": 52, "Madagascar": 450, "Italy": 380, "Bhutan": 64, "Sudan": 729, "Nepal": 524, "Malta": 470, "Netherlands": 528, "Northern Mariana Islands": 580, "Suriname": 740, "United Kingdom": 826, "Anguilla": 660, "Micronesia (Federated States of)": 583, "Holy See": 336, "Israel": 376, "Indonesia": 360, "Iceland": 352, "Zambia": 894, "Senegal": 686, "Papua New Guinea": 598, "Saint Kitts and Nevis": 659, "Trinidad and Tobago": 780, "Zimbabwe": 716, "Germany": 276, "Denmark": 208, "Kazakhstan": 398, "Poland": 616, "Eritrea": 232, "Kyrgyzstan": 417, "British Indian Ocean Territory": 86, "Montserrat": 500, "Mexico": 484, "Sri Lanka": 144, "Latvia": 428, "South Sudan": 728, "Guyana": 328, "Guadeloupe": 312, "Honduras": 340, "Myanmar": 104, "Bouvet Island": 74, "Egypt": 818, "Nicaragua": 558, "Singapore": 702, "Serbia": 688, "Botswana": 72, "Antarctica": 10, "Congo": 178, "Sint Maarten (Dutch part)": 534, "Greece": 300, "Paraguay": 600, "Gabon": 266, "Comoros": 174}

//Add country names to Topojson object. 
countries.map(function(d){
  for(key in countryCodeMap){
    if (countryCodeMap[key] == d.id){
      d.name = key

    }
}
})

console.log(tennis)

d3.values(tennis).forEach(function(d){      
      d.COUNTRY_ID = +d.COUNTRY_ID
      d.DATE = +d.DATE;
      d.COUNT = +d.COUNT;      
  })

// Make the year selected available to all functions.
var year;


var tip = d3.tip()
            .attr('class','tooltip')
            // .offset([-5,0])
            // .offset(function(){
            //   // event.clientX
            //   // event.clientY
            //   // console.log(this)
            //   // return [this.getBBox().height / 10, -5]
            //   // console.log(event.top)

            // })
            .offset([-10,0])
            .direction('se')
            .html(function(d){
              id = d.id
              returnVal ='Nation Info Unavailable';
              
              selectCountry = d3.values(tennis).filter(function(d){
                    return ((d.DATE == year) && (d.COUNTRY_ID == id));
                });
                            
              if (selectCountry.length==0){
                    returnVal = "<div id=\"tip\">  <p> <span id=\"countryName\"> " + d.name + "</span> </p>" +
                        "<p> had <span id=\"playerCount\">" + "NO" + "</span> players ranked in top 100 in\t" + "<span id=\"year\">" + year + "</span>. </p> </div>"
                }
              
              else{ 
                  for (var key in countryCodeMap){              
                    if (countryCodeMap[key] == d.id){           
                 returnVal = "<div id=\"tip\">  <p> <span id=\"countryName\">" + d.name + "</span>  </p>" +
                        "<p>had <span id=\"playerCount\">" + selectCountry[0].COUNT + "</span> \tplayers ranked in top 100 in <span id=\"year\">" + year + "</span>. </p> </div>"     

                  // returnVal = " <div id=\"tip\">" + d.name +" <br> year: " + year + "<br>" + "count: " +selectCountry[0].COUNT +"</div>"
                  }
 
              }
            }

              return returnVal;
             
            })

svg.call(tip)

// d3.select('body').append('div').attr("id","try").html(function(){ return "adsfs"})
var divContainer = d3.select('body').append('div').attr("id","try")

// var svgInDiv = divContainer.append('svg').attr('class','divSvgContainer')
// svgInDiv.append('rect').attr('x',20).attr('y',30).attr('width','300').attr('height','150').attr('fill','blue')


var xAxis = d3.svg.axis().orient('bottom').scale(xScale).ticks(26).tickFormat(d3.format("d"))


minYear = d3.min(tennis, function(d){
      return d.DATE
  })

maxYear = d3.max(tennis, function(d){
    return d.DATE

})
maxValue =  d3.max(tennis, function(d){
              return d.COUNT })

// minValue = d3.min(tennis, function(d){
//   return d.COUNT
//  })
minValue =1;

// var colorScale = d3.scale.log().domain([minValue,maxValue]).range(['#ddedf4','#489fc5'])
var colorScale = d3.scale.log().domain([minValue,maxValue]).range(['#fff1eb','#ff4c00'])

var initialFlag = false;

var updateMapColor = function (y){
  year = y;
  var rankingList ={}

  coloredWorldMap.transition().delay(100).ease('circle',0.7,'out-in').duration(650).attr('fill',function(d){
      a = d;    
      x = d3.values(tennis).filter(function(d){
          return (d.DATE == year)
      })       
      rankingList = x;

      x = d3.values(x).filter(function(d){
        return (d.COUNTRY_ID == a.id)
      })

      if (x.length != 0){
              if(x[0].COUNT == 0){
                return "#fff"
              }
              else{
              return colorScale(x[0].COUNT)}     
          }

          else{
              return '#fff'
          }

    return colorScale(x[0].COUNT)
  })


rankingListArray = [];

rankingList.forEach(function(d){
  nationality = d.COUNTRY
  d.players.forEach(function(d){
        d['NATIONALITY']= nationality;
  })
  rankingListArray = rankingListArray.concat(d.players)
})

rankingListArray.sort(function(a,b){
  return a.RANKING - b.RANKING
})





if (initialFlag != false){
  var y = d3.select('g.rankingList').selectAll('text').data(rankingListArray)
  y.exit().remove();
  console.log(y)

y.enter().append('text')
y.attr('x',0).attr('y',function(d,i){
  return 15*i
}).text(function(d){return (d.PLAYER_NAME +"("+d.NATIONALITY+')'+ + d.RANKING)}).attr('class',function(d){
  return d.NATIONALITY
})

d3.select('.rankingListYear').text(function(d){
  return 'Year: ' + year})

}



else if (initialFlag == false){

  var rankingListWrapper = d3.select('svg').append('g').attr('class','rankingListWrapper').attr('transform','translate(0,750)')
  rankingListWrapper.append('text').text(function(d){ return 'Year: ' + year}).attr('class','rankingListYear')

  var rankingList = rankingListWrapper.append('g').attr('class','rankingList').attr('transform','translate(0,15)')

var x = rankingList.selectAll('text').data(rankingListArray)

x.enter().append('text')
x.attr('x',0).attr('y',function(d,i){
  return 15*i
}).text(function(d){return (d.PLAYER_NAME +"("+d.NATIONALITY+')'+ + d.RANKING)}).attr('class',function(d){
  return d.NATIONALITY
})}

initialFlag = true;
}


var heightScale = d3.scale.pow().exponent(1.2).domain([1,maxValue]).rangeRound([15,100])
// var heightScale = d3.scale.log().domain([1,maxValue]).rangeRound([15,100])

var rectHeight = 60;

var histogramTitle ="Number of Tennis Players from"


 var coloredWorldMap = g.selectAll("path")
      .data(countries)
      .enter()  
      .append("path")
      .attr("d", path)
      .attr("class",function(d){

        return d.name
        // console.log(d)
      })
      .attr("fill","#ddd")
      coloredWorldMap.on('mouseover',tip.show)
      .on('mouseout',tip.hide)

      d3.selectAll('path')
      .on('click', function(d){
        
        drawBarChart(d)
        // highlightPlayers(d)
        //loadHistogram(d)
            
      })
      updateMapColor(1982)

var containerWidth = 300;
var containerHeight = 400
var divContainer = d3.select('body').append('div').attr('class','divContainer')
// var svgInDivContainer = divContainer.append('svg').attr('width',200).attr('class','svgInDivContainer').attr('x',50).attr('y',100).style('position','absolute')


var selectedCountry = d3.select('.America').classed('selected',true)
    

function highlightPlayers(d){
  var nationality = d.name
  console.log(d.name)
  var anySelectedPlayers = d3.select('g.rankingList').selectAll('.selectedPlayers')

  /*
  If there are any selected players, then turn off the class
  */
    console.log(anySelectedPlayers[0].length)
  if(anySelectedPlayers[0].length > 0){
    // console.log(anySelectedPlayers.classed('selectedPlayers'))
    anySelectedPlayers.style('opacity',1).attr('font-size','12')
      anySelectedPlayers.classed('selectedPlayers',false)



  }


  /*
  Once a user selects a country, the players in the ranking should be highlighted (opacity =1).
  The rest of players should be dimemd (opacity 0.8)

  */

  else{
    /*
    만약에 nationality of anySelectedPlayers == d.name
    highlight 을 turn off 해야됨
    */
    // console.log(anySelectedPlayers[0][0])

    console.log(anySelectedPlayers)
    // if(anySelectedPlayers[0].NATIONALITY == d.name){
    //   console.log(anySelectedPlayers)
    //   anySelectedPlayers.classed("selectedPlayers",false).style('opacity',1).attr('font-size','12')
    // }
    console.log(d3.select('g.rankingList').selectAll("."+nationality))
    d3.select('g.rankingList').selectAll("."+nationality).classed("selectedPlayers",true)
    // d3.selectAll('g.rankingList text').style('opacity','0.6')
    d3.selectAll('.selectedPlayers').style('opacity','0.8').attr('font-size','15')
  }
   console.log(d3.select('g.rankingList').selectAll('text'))
}  

function drawBarChart(d){
        selectCountryName = d.name
        // selectCountryName = event['path'][0]['__data__']['name']
        selectCountry = d.id    

        countryArray = d3.values(tennis).filter(function(d){
            return d.COUNTRY_ID == selectCountry
        })

/*
1. Select existing bars
2. Need the data array of existing bars.
2. remove the data.
3. remove the bar (the svg element)

*/

  var addRect = d3.select('g.nations').selectAll('.countryRect')
                  .data(countryArray)
                  
                  addRect.exit().remove()
                  
              addRect.enter()
              .append('rect')
              
              addRect
              .attr({
                          x: function(d,i){ 
                                return(xScale(d.DATE))
                                // return (rectWidth(d.DATE)) 
                              },
                          y: function(d){ 
                             return (rectHeight + 50) 
                          },
                          width: function(d){ 
                                return (width-150)/yearArray.length
                                // return rectWidth.rangeBand()
                              },
                          height: 0,
            
            fill: 'steelblue'
        })
              .transition().duration(300).ease('linear').attr("height",function(d){ 
                return heightScale(d.COUNT)
              })
              .attr('y',function(d){
                return (rectHeight + 50) - heightScale(d.COUNT) 
              })
          .attr('class','countryRect').attr('id',function(d){
          return ('year' + d.DATE)
        })
      

        

      addRect.on('mouseover',function(d){
        console.log(this.getBBox().x)
        var xCoord = (this.x.baseVal.value) + 20;
      // var xCoord = (this.getBBox().x)+50
      
  
        d3.select('.divContainer').style('display','block')
        divContainer.style('left', xCoord + 'px').style('top',(190) +'px')
  
        var playerList = d.players;
        playerList.sort(function(a,b){ return a.RANKING - b.RANKING})
  
        var table = divContainer.append('table')
        var headerRow = table.append('tr')
        headerRow.append('th').html("Ranking").attr("class",'ranking')
        headerRow.append('th').html("Name").attr("class",'name')
  
        var players = table.append('tbody').selectAll('tr').data(playerList).enter()
        var eachRow = players.append('tr')
        var eachCell1 = eachRow.append('td').attr('class','rankingCell').html(function(d){return d.RANKING})
        var eachCell2 =  eachRow.append('td').attr('class','nameCell').html(function(d){return d.PLAYER_NAME})

        // var addPlayers = players.append('text').text(function(d){
          // return d.PLAYER_NAME
        
  })
  .on('mouseout',function(d){
      d3.select('.divContainer').style('display','none')
      // console.log(d3.select('.divContainer'))
        d3.select('.divContainer').select('table').remove()
  })



      var y = d3.select('g.nations').selectAll('text.count')
            .data(countryArray)

            y.exit().transition().duration(200).style('opacity',0).remove()

        y.enter()
        .append('text')
        
        y.attr('class','count').style('opacity',0).text(function(d){
            return d.COUNT
        })
        .attr('text-anchor','middle')
        
        y.attr('x',function(d,i){
            return(xScale(d.DATE) + ((width-150)/yearArray.length)/2)
        })
        .attr('y', function(d){
          return (rectHeight + 50) - heightScale(d.COUNT) + 11
        })
        .attr("pointer-events", "none")
        .transition().duration(850).style('opacity',1)

histogramNationName.text("Country: ").append('tspan').text(selectCountryName) 
}

   

/* 
Working code for Histogram
The length of entire histogram = main svg width(1200) -150 = 1050


*/

    var padding_right = 8
    var nations = svgHistogram.append('g').attr("class","nations").attr('transform','translate(50,40)')

    var histSelection = nations.selectAll('rect.countryRect')
              .data(function(){
                        return d3.values(tennis).filter(function(d){
                              return d.COUNTRY_ID == 840;
                              })
                }).enter()

              histSelection.append('rect')
              .attr({
                      class: function(d){return "countryRect"},
                          x: function(d,i){ 
                                return(xScale(d.DATE))
                                // return (rectWidth(d.DATE)) 
                              },
                          y: function(d){ 
                              return (rectHeight + 50) - heightScale(d.COUNT)
                            },
                          width: function(d){ 
                                return (width-150)/yearArray.length
                                // return rectWidth.rangeBand()
                              },
            height: function(d){ 
               return heightScale(d.COUNT)},
            fill: 'steelblue'
        }).on('mouseover',function(d){
  
        


        var xCoord = parseInt(this.x.baseVal.value)+20
  
  
        d3.select('.divContainer').style('left', xCoord + 'px').style('display','block')
        divContainer.style('top',this.y.baseVal.value).style('top',(190) +'px')
  
        var playerList = d.players;
        playerList.sort(function(a,b){ return a.RANKING - b.RANKING})
  
        var table = divContainer.append('table')
        var headerRow = table.append('tr')
        headerRow.append('th').html("Ranking").attr("class",'ranking')
        headerRow.append('th').html("Name").attr("class",'name')
  
        var players = table.append('tbody').selectAll('tr').data(playerList).enter()
        var eachRow = players.append('tr')
        var eachCell1 = eachRow.append('td').attr('class','rankingCell').html(function(d){return d.RANKING})
        var eachCell2 =  eachRow.append('td').attr('class','nameCell').html(function(d){return d.PLAYER_NAME})


        // var addPlayers = players.append('text').text(function(d){
          // return d.PLAYER_NAME
        
  })
  .on('mouseout',function(d){
      d3.select('.divContainer').style('display','none')
        d3.select('.divContainer').select('table').remove()
  })

      





      


              // Add player count to at the top of each bar

        var countLabel = d3.select('g.nations').selectAll('text.count')
        .data(function(){
            return d3.values(tennis).filter(function(d){
              return d.COUNTRY_ID == 840;
            })
        })

        countLabel.enter()
        .append('text')
        .attr('class','count')
        .attr('x',function(d,i){
            return(xScale(d.DATE) + ((width-150)/yearArray.length)/2)
        })
        .attr('y', function(d){
          return (rectHeight + 50) -heightScale(d.COUNT) +11
        })
        .text(function(d){
            return d.COUNT
        })
        .attr('text-anchor','middle')
        .attr("pointer-events", "none")
     var x_axis = nations.append('g').attr("class","xAxis").attr("transform", "translate(0," + (rectHeight+50) + ")").call(xAxis)
      

      //adjust tick location (shift to right so that tick is placed under the middle of each bar)
        

        d3.selectAll('.tick line').attr('x1',function(d){ return ((width-150)/yearArray.length)/2}).attr('x2',function(d){ return ((width-150)/yearArray.length)/2})
        d3.selectAll('.tick text').attr('x',function(d){ return ((width-150)/yearArray.length)/2})



// var selectRect = d3.select('g.nations').selectAll('.countryRect')
// selectRect.on('mouseover',function(d){
  
//         console.log(d)
//         d3.select('.divContainer').style('left',this.x.baseVal.value).style('left',this.x.baseVal.value + 'px').style('display','block')
//         divContainer.style('top',this.y.baseVal.value).style('top',(this.y.baseVal.value+90) +'px')
  
//         var playerList = d.players;
//         playerList.sort(function(a,b){ return a.RANKING - b.RANKING})
  
//         var table = divContainer.append('table')
//         var headerRow = table.append('tr')
//         headerRow.append('th').html("Ranking").attr("class",'ranking')
//         headerRow.append('th').html("Name").attr("class",'name')
  
//         var players = table.append('tbody').selectAll('tr').data(playerList).enter()
//         var eachRow = players.append('tr')
//         var eachCell1 = eachRow.append('td').attr('class','rankingCell').html(function(d){return d.RANKING})
//         var eachCell2 =  eachRow.append('td').attr('class','nameCell').html(function(d){return d.PLAYER_NAME})

//         // var addPlayers = players.append('text').text(function(d){
//           // return d.PLAYER_NAME
        
//   })
//   .on('mouseout',function(d){
//       d3.select('.divContainer').style('display','none')
//       // console.log(d3.select('.divContainer'))
//         d3.select('.divContainer').select('table').remove()
//   })

// var selectRect = d3.selectAll('rect')
// selectRect.on('mouseover',function(d){ 
//         var playerList = d.players
//         playerList.sort(function(a,b){ return a.RANKING - b.RANKING})
        
//         svgInDivContainer.style('left',this.x.baseVal.value).style('top',this.y.baseVal.value+80)
//         svgInDivContainer.attr('height',function(d){
//           console.log(playerList.length)
//           return ((playerList.length *16)+36)
//         })
//        var players = svgInDivContainer.selectAll('text').data(playerList).enter()
//         var addPlayers = players.append('text').text(function(d){
//             console.log(d.PLAYER_NAME) 
//            return d.PLAYER_NAME + ' '+ d.RANKING})
//         .attr('x',30).attr('y',function(d,i){return 30+i*16}).attr('fill','white')
//         d3.select('.divContainer').style('display','block')
// })
// .on('mouseout',function(d){

//         d3.select('.divContainer').style('display','none')
//         d3.select('.divContainer').selectAll('text').remove()
// })

/*      
    Wait until rectangle works correctly.

        var textSelection = nations.selectAll('.count')
              .data(function(){
              return d3.values(tennis).filter(function(d){
                  return d.COUNTRY_ID == 840;
              })
          })

        textSelection.enter()
        .append('text')
        .attr({
          class:"count",
          x: function(d,i){ 

            
                return rectWidth(d.DATE)
                
                 
            // console.log(rectWidth(yearArray[i])+ 11)
            // return (rectWidth(yearArray[i])+ 11)
            
             },
                // return (i*40)+(2*i)+17 },
          y: function(d){ 
                return (heightScale(d.COUNT)+20)
                // return rectHeight-10
              },
          fill: 'white',
          'font-size': '11px'
          })
        .attr("font-family", "sans-serif")
        .text(function(d){
          console.log(d)
              return d.COUNT
          })
        .attr("text-anchor", "middle")
  
  */
      // histogramNationName.text("Country: " + selectCountryName).attr('x',20).attr('y',30)
        var histogramNationName = nations.append('text').attr("class",'histogramNationName')
        histogramNationName.text("Country: ").attr('x',0).attr("y",-20).append('tspan').text("United States")

        

  

 // var yearListBackground = d3.select(".yearListBackground").append('svg').append("g")
   
   var yearListGruopBackground = svg.append('g').attr('class','yearListBackground')
   yearListGruopBackground.append('rect').attr('width','42px').attr('height',580).attr("transform", "translate(0," + (height/10) + ")").attr('fill','#d8d8d8').attr('x',35).style('opacity','0.8')
 
var animateMapButton = d3.select('body').append('button').attr({   
                                            class: "button",
                                            id: "animateMap"})
                                  .text("Animate the map")
                                  
animateMapButton.on("click", animateTheMap)

var animateTimer;

function animateTheMap(arg){

                                        animateMapButton.text("Stop the Animation")
                                        animateMapButton.on('click',function(){
                                          stopAnimateTheMap(i)
                                        })
                        
                                        // If the selected current year is the last year, then the animation should begin from the year 1982 (i=0)
                                        // But, anitmation should stop when the year reaches the last year and resume only when there is more year to go.
                                        currentYear = parseInt(d3.select('text.selected').attr('id').substr(-4,4)) ;
                                        i = currentYear - 1982;
                                        
                                        // if the current year is 2016, the last year with available info, then reset the index to 0
                                        // so the aniamtion will begin from 1982

                                        if (i == yearArray.length-1){
                                          i =0;
                                        }
                                        
                                        animateTimer = setInterval(function(){
                                    
                                            if(i<yearArray.length){
                                                 
                                                 d3.select('text.selected').classed('selected',false)
                                                 d3.select('#year'+yearArray[i]).classed('selected',true)
                                                 updateMapColor(yearArray[i])
                                                 i++;
                                                
                                              }
                                            else{
                                              //Animation has run its course
                                              console.log("Reached the end")
                                              clearInterval(animateTimer)
                                              // Set next Animation to the beginning.
                                              // i=0;
                                              animateMapButton.text("Animate the map").on('click',animateTheMap)
                                            }
                                          },2100)
                              }


 function stopAnimateTheMap(arg){
                                      // arg is the index of the yearArray at which the animation was stopped
                                      // It can be passed to animateTheMap so that the animation can be resumed from the paused year.

                                    // var pausedYear = parseInt(d3.select('text.selected').attr('id').substr(-4,4));
                                      clearInterval(animateTimer)                                    
                                      animateMapButton.text("Animate the map")
                                      animateMapButton.on("click",function(){
                                        animateTheMap()
                                      })
                                  }



var yearListGroup = yearListGruopBackground.append('g').attr('class','yearListGroup').attr("transform", "translate(0," + (95) + ")").selectAll('text').data(yearArray).enter() 

    yearListGroup.append('text').text(function(d){return d}).attr('x','40').attr('y',function(d,i){ return 16*i }).attr('font-size','13px').attr('class','year').attr("id",function(d){return "year"+d})
    .attr('fill','black')
    .on('click',function(d){ 
        d3.select("text.selected").classed('selected',false)
      d3.select(this).classed('selected',true)
      updateMapColor(d)})

    d3.select('#year1982').classed('selected',true)

    // yearListGroup.append('text').text("ANIMATE THE MAP!").attr('x',40).attr('y',450).on('click',animate)


var antartica = document.getElementsByClassName('Antarctica')[0]
console.log(document.getElementsByClassName('Antarctica'))
antartica.parentNode.removeChild(antartica)



var sliderGroup = svg.append("g")
    .attr("class", "sliderGroup")
    .attr("transform", "translate(0,800)");


// var slider = d3.slider().scale(xYear).axis(xAxis)
// sliderGroup.call(d3.slider())
d3.select()
d3.select('.sliderGroup').call(d3.slider())




    

}


</script>



<p id="credit">
Data Source: https://data.world/sixmanguru/mens-year-end-atp-rankings
</p>
</body>
</html>